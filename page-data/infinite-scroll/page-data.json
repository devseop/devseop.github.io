{"componentChunkName":"component---src-templates-post-template-tsx","path":"/infinite-scroll/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"id":"b6815257-873c-526f-822d-a29bdca965df","html":"<p>프론트엔드 기술 과제에서는 리스트 페이지에서 무한 스크롤을 구현하라는 요구 사항을 본 적이 있다. 나 또한 기술 과제와 <a href=\"/wanted-preonboarding-review\">원티드 프리온보딩 인턴십</a>을 진행하면서 종종 마주쳤다. 무한 스크롤은 방대한 양의 콘텐츠를 스크롤할 수 있는 기술로 페이지를 아래로 스크롤할 때 새로고침이 되면서 콘텐츠를 추가적으로 불러오는 방법이다. 프론트엔드 개발자라면 피할 수 없는 무한 스크롤에 대해 복습하고 정리하는 차원에서 작성해보기로 했다.</p>\n<h2 id=\"무한-스크롤-먼저보기\" style=\"position:relative;\"><a href=\"#%EB%AC%B4%ED%95%9C-%EC%8A%A4%ED%81%AC%EB%A1%A4-%EB%A8%BC%EC%A0%80%EB%B3%B4%EA%B8%B0\" aria-label=\"무한 스크롤 먼저보기 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>무한 스크롤 먼저보기</h2>\n<ul>\n<li><a href=\"https://github.com/devseop/po-fe-12th-w2\" target=\"_blank\" rel=\"nofollow\">https://github.com/devseop/po-fe-12th-w2</a></li>\n</ul>\n<h2 id=\"사용한-기술\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EC%9A%A9%ED%95%9C-%EA%B8%B0%EC%88%A0\" aria-label=\"사용한 기술 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용한 기술</h2>\n<p>무한 스크롤을 3가지 방법으로 구현한 경험이 있는데 그 때마다 사용된 기술은 아래와 같다.</p>\n<ul>\n<li>useEffect</li>\n<li>Intersection Observer API</li>\n<li>useInfiniteQuery (React-Query)</li>\n</ul>\n<h2 id=\"1-useEffect\" style=\"position:relative;\"><a href=\"#1-useEffect\" aria-label=\"1 useEffect permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. useEffect</h2>\n<p><code class=\"language-text\">useEffect</code>를 이용한 방법에서는 현재 스크롤된 위치와 브라우저의 세로 크기, 그리고 콘텐츠의 총 높이를 이용해 구현했다. 여기서 필요한 요소들은 아래와 같다.</p>\n<ul>\n<li><code class=\"language-text\">window.scrollY</code>: 현재 스크롤의 위치</li>\n<li><code class=\"language-text\">document.documentElement.clientHeight</code>: 브라우저의 보이는 화면 높이</li>\n<li><code class=\"language-text\">document.documentElement.scrollHeight</code>: 콘텐츠의 총 높이</li>\n</ul>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">onScroll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n      window<span class=\"token punctuation\">.</span>scrollY <span class=\"token operator\">+</span> document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>clientHeight <span class=\"token operator\">></span>\n      document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>scrollHeight <span class=\"token operator\">-</span> <span class=\"token number\">300</span>\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">//TODO: 추가적인 데이터를 불러오는 로직</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scroll'</span><span class=\"token punctuation\">,</span> onScroll<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scroll'</span><span class=\"token punctuation\">,</span> onScroll<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p>useEffect를 선언하고 스크롤 이벤트시 수행될 <code class=\"language-text\">onScroll</code> 함수를 작성한다. <code class=\"language-text\">window.scrollY + document.documentElement.clientHeight</code>는 사용자가 보고 있는 페이지의 맨 아래 위치를, <code class=\"language-text\">document.documentElement.scrollHeight - 300</code>은 전체 콘텐츠의 높이에서 300px을 제외한 값을 나타낸다. 위 조건은 <strong>사용자가 페이지의 바닥에 거의 도달했는지를 확인</strong>하는 조건이다. 스크롤 이벤트가 발생하면서 조건이 참이 된다면 그 때 데이터를 불러오도록 하는 방식이다. 그리고 <code class=\"language-text\">() => {window.removeEventListener('scroll', onScroll);};</code>를 반환하도록 하여 컴포넌트가 언마운드될 때 스크롤 이벤트 리스너를 제거하여 추가적인 호출이 진행되지 않도록 한다.</p>\n<h2 id=\"2-Intersection-Observer-API\" style=\"position:relative;\"><a href=\"#2-Intersection-Observer-API\" aria-label=\"2 Intersection Observer API permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Intersection Observer API</h2>\n<p>Intersection Observer API는 관찰 중인 요소(Element)가 사용자가 보고 있는 화면 영역(Viewport) 안에 들어왔는지를 알려주는 API이다. 해당 API는 무한 스크롤시 가장 많이 사용되는 방법이라고 생각하는데, useEffect는 조건을 설정하기 위한 코드가 번잡스럽고 useInfiniteQuery는 React-Query에 내장된 기능으로 해당 기술을 사용하지 않으면 의미가 없기 때문이다.</p>\n<br />\n<p>나는 Intersection Observer API를 이용하여 커스텀 훅을 만들고 이를 원하는 컴포넌트로 가져와서 사용하는 방식으로 구현했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> useInfinityScroll <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>MutableRefObject<span class=\"token operator\">&lt;</span>HTMLDivElement <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> containerRef <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>useRef <span class=\"token operator\">&lt;</span> HTMLDivElement<span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span> <span class=\"token operator\">></span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      root<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n      rootMargin<span class=\"token operator\">:</span> <span class=\"token string\">'20px'</span><span class=\"token punctuation\">,</span>\n      threshold<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> observer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntersectionObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> target <span class=\"token operator\">=</span> entries<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">.</span>isIntersecting<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>containerRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      observer<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>containerRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>containerRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        observer<span class=\"token punctuation\">.</span><span class=\"token function\">unobserve</span><span class=\"token punctuation\">(</span>containerRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>containerRef<span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> containerRef<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>해당 API를 사용할 때 옵션은 필수가 아니지만 설정해 놓으면 나중에 자세한 조정이 필요할 때 편리하다.</p>\n<ul>\n<li><code class=\"language-text\">root</code>: 관찰 대상이 화면에 들어왔는지 여부를 감지한다. 기본값은 null이다.</li>\n<li><code class=\"language-text\">rootMargin</code>: 관찰 대상을 감지하는 영역을 바깥 범위(Margin)까지 확장한다. 기본값은 0px이며 해당 옵션값을 설정할 때는 문자열 형태로 해야한다.</li>\n<li><code class=\"language-text\">threshold</code>: 관찰 대상이 화면 영역에 얼마나 들어왔을 때 콜백 함수를 호출할지 결정한다. <code class=\"language-text\">rootMargin</code>과 마찬가지로 기본값은 0(0%)이다. 최대 1(100%)까지 설정이 가능하다.</li>\n</ul>\n<br />\n`IntersectionObserver`의 인스턴스인 `observer`를 선언한다. 이 때 `observer`는 `entries`라는 배열을 인자로 받는다. 그리고 인자의 첫번째 요소(target)이 교차하고 있는지 확인하고 조건이 참이라면 callback() 함수를 호출하여 더 많은 정보를 불러오도록 한다. 첫번째 방법과 마찬가지로 추가적인 호출이 진행되지 않도록 클린업 함수를 반환하도록 한다. 마지막으로 관찰할 대상 요소를 참조하기 위해 선언된 `containerRef`를 반환하도록 한다. 이렇게 작성된 `useInfinityScroll`를 컴포넌트에서 불러와 반환된 `containerRef`를 특정 요소에 연결하면, 해당 요소가 뷰포트에 들어올 때 추가적인 데이터를 불러올 수 있도록 한다.\n<h2 id=\"3-useInfiniteQuery-React-Query\" style=\"position:relative;\"><a href=\"#3-useInfiniteQuery-React-Query\" aria-label=\"3 useInfiniteQuery React Query permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. useInfiniteQuery (React-Query)</h2>\n<p><code class=\"language-text\">useInfiniteQuery</code> 이용한 방법은 한 기업의 기술 과제를 진행하면서 구현했는데 이 때 서버 사이드의 상태와 클라이언트 사이드의 상태를 나누어 관리해보고 싶어서 <code class=\"language-text\">React-Query(서버 사이드)</code>와 <code class=\"language-text\">zustand(클라이언트 사이드)</code>로 나누어 리스트 페이지에서의 무한 스크롤을 구현했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">/* useInfiniteQuery 기본 구조 */</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n  fetchNextPage<span class=\"token punctuation\">,</span>\n  fetchPreviousPage<span class=\"token punctuation\">,</span>\n  hasNextPage<span class=\"token punctuation\">,</span>\n  hasPreviousPage<span class=\"token punctuation\">,</span>\n  isFetchingNextPage<span class=\"token punctuation\">,</span>\n  isFetchingPreviousPage<span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>result\n<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useInfiniteQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  queryKey<span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">queryFn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> pageParam <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fetchPage</span><span class=\"token punctuation\">(</span>pageParam<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>options<span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">getNextPageParam</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">lastPage<span class=\"token punctuation\">,</span> allPages</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> lastPage<span class=\"token punctuation\">.</span>nextCursor<span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">getPreviousPageParam</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">firstPage<span class=\"token punctuation\">,</span> allPages</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> firstPage<span class=\"token punctuation\">.</span>prevCursor<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>useInfiniteQuery의 반환 값 중, <code class=\"language-text\">fetchNextPage</code>, <code class=\"language-text\">hasNextPage</code>, <code class=\"language-text\">isFetchingNextPage</code>가 자주 쓰인다.</p>\n<ul>\n<li><code class=\"language-text\">fetchNextPage</code>: 다음 페이지를 요청할 때 사용되는 메서드</li>\n<li><code class=\"language-text\">hasNextPage</code>: 다음 페이지가 있는지 판별하는 boolean 값</li>\n<li><code class=\"language-text\">isFetchingNextPage</code>: 다음 페이지를 불러오는 중인지 판별하는 boolean 값</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">/* useGetArticles.ts */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useGetArticles</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>filters<span class=\"token operator\">:</span> FilterValues<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetchArticles</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> pageParam <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> headline<span class=\"token punctuation\">,</span> date<span class=\"token punctuation\">,</span> countries <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> filters<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> params<span class=\"token operator\">:</span> ApiParamsProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      page<span class=\"token operator\">:</span> pageParam<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> rawData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">getConvertedArticles</span><span class=\"token punctuation\">(</span>rawData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token function\">useInfiniteQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'articles'</span><span class=\"token punctuation\">,</span> filters<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> fetchArticles<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">getNextPageParam</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>_lastpage<span class=\"token punctuation\">,</span> allpage<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> nextOffset <span class=\"token operator\">=</span> allpage<span class=\"token punctuation\">.</span>length <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> nextOffset<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    retry<span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">retryDelay</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>retryAttempt<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>retryAttempt <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    staleTime<span class=\"token operator\">:</span> <span class=\"token number\">5</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 5분 후에 데이터가 오래된 것으로 간주</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* ArticleList.tsx */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ArticleList</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> isVisible <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useToastStore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> filters <span class=\"token operator\">=</span> <span class=\"token function\">useFilterStore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> state<span class=\"token punctuation\">.</span>filters<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n    data<span class=\"token punctuation\">,</span>\n    isError<span class=\"token punctuation\">,</span>\n    isLoading<span class=\"token punctuation\">,</span>\n    fetchNextPage<span class=\"token punctuation\">,</span>\n    hasNextPage<span class=\"token punctuation\">,</span>\n    isFetchingNextPage<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useGetArticles</span><span class=\"token punctuation\">(</span>filters<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> loadingRef <span class=\"token operator\">=</span> <span class=\"token function\">useInfinityScroll</span><span class=\"token punctuation\">(</span>fetchNextPage<span class=\"token punctuation\">,</span> hasNextPage <span class=\"token operator\">??</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isLoading<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Spinner</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isError<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ErrorPage</span></span>\n        <span class=\"token attr-name\">pageText</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>데이터를 불러오는데 실패했습니다.<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">buttonText</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>새로고침<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token punctuation\">/></span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 검색 결과가 없을 떄</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>pages<span class=\"token punctuation\">.</span><span class=\"token function\">flatMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ErrorPage</span></span>\n        <span class=\"token attr-name\">pageText</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>조건에 맞는 기사가 없습니다.<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">buttonText</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>돌아가기<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token punctuation\">/></span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>isVisible <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">createPortal</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ToastMessage</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SearchFilterBar</span></span> <span class=\"token attr-name\">filterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>article<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ListContainer</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token punctuation\">{</span>data<span class=\"token operator\">?.</span>pages\n          <span class=\"token punctuation\">.</span><span class=\"token function\">flatMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> page<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>item<span class=\"token operator\">:</span> ArticleProps<span class=\"token punctuation\">,</span> index<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ArticleListItem</span></span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>index<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">data</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>loadingRef<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>isFetchingNextPage<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ListContainer</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>데이터를 불러오는 커스텀 훅(useGetArticles.ts)에서 <code class=\"language-text\">useInfiniteQeury</code>를 사용하여 <code class=\"language-text\">data</code>, <code class=\"language-text\">isError</code>, <code class=\"language-text\">isLoading</code>, <code class=\"language-text\">fetchNextPage</code>, <code class=\"language-text\">hasNextPage</code>, <code class=\"language-text\">isFetchingNextPage</code>를 반환한다. 부모 컴포넌트(ArticleList.tsx)에서는 데이터 페칭이 실패한 경우(<code class=\"language-text\">isError</code>)에는 에러 페이지를, 로딩(<code class=\"language-text\">isLoading</code>)시에는 로딩 컴포넌트를 보여준다. 스크롤을 내릴 때 viewport에 진입했는지의 여부를 확인하기 위해 Intersection Observer API를 이용하여 커스텀 훅(useInfinityScroll.ts)을 작성했고 이를 컴포넌트 최하단에 관찰 요소로 적용하여 다음 페이지의 데이터를 가져오도록 했다.</p>\n<h2 id=\"느낀-점\" style=\"position:relative;\"><a href=\"#%EB%8A%90%EB%82%80-%EC%A0%90\" aria-label=\"느낀 점 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>느낀 점</h2>\n<ul>\n<li>여러 방법을 통해 구현해봤는데 <strong>화면의 관찰하고 조건이 성립되면 데이터를 불러오는 방식</strong>이 기본임을 알게 됐다.</li>\n<li><code class=\"language-text\">useInfiniteQuery</code>는 무한 스크롤을 위한 참조까지 가능하다고 생각했으나, 데이터를 불러오기 더 나은 방법일 뿐이다.</li>\n<li>작성된 코드들을 보면서 좀 더 클린하게 작성할 순 없었는지 아쉬움이 남는다.</li>\n<li>서비스를 운영하는 기업의 입장에서는 해당 기능이 체류시간의 증가라는 이득을 가져다주지만, 디자이너였던 나에게 무한 스크롤은 액션 자체에 중독시킨다는 디자인 윤리에 대한 문제가 있기도 하다. 언젠가 이런 다크 패턴을 없애는 인터랙션을 개발해보고 싶다.</li>\n</ul>","tableOfContents":"<ul>\n<li><a href=\"#%EB%AC%B4%ED%95%9C-%EC%8A%A4%ED%81%AC%EB%A1%A4-%EB%A8%BC%EC%A0%80%EB%B3%B4%EA%B8%B0\">무한 스크롤 먼저보기</a></li>\n<li><a href=\"#%EC%82%AC%EC%9A%A9%ED%95%9C-%EA%B8%B0%EC%88%A0\">사용한 기술</a></li>\n<li><a href=\"#1-useeffect\">1. useEffect</a></li>\n<li><a href=\"#2-intersection-observer-api\">2. Intersection Observer API</a></li>\n<li><a href=\"#3-useinfinitequery-react-query\">3. useInfiniteQuery (React-Query)</a></li>\n<li><a href=\"#%EB%8A%90%EB%82%80-%EC%A0%90\">느낀 점</a></li>\n</ul>","frontmatter":{"title":"무한 스크롤 구현하기","date":"2023.09.02."}}}]}},"pageContext":{"slug":"/infinite-scroll/","allPosts":[{"node":{"id":"cc46ebdf-d56e-53d2-ae84-c356d1276cba","fields":{"slug":"/lorem-ipsum-generator/"},"frontmatter":{"title":"한국의 시를 이용한 로렘 입숨 생성기","date":"2023-10-07"}},"next":{"id":"921c146d-b278-5852-9c6f-e1fbb57cb57d","fields":{"slug":"/wanted-preonboarding-review/"},"frontmatter":{"title":"원티드 프리온보딩 인턴십(프론트엔드) 후기"}},"previous":null},{"node":{"id":"921c146d-b278-5852-9c6f-e1fbb57cb57d","fields":{"slug":"/wanted-preonboarding-review/"},"frontmatter":{"title":"원티드 프리온보딩 인턴십(프론트엔드) 후기","date":"2023-09-17"}},"next":{"id":"b6815257-873c-526f-822d-a29bdca965df","fields":{"slug":"/infinite-scroll/"},"frontmatter":{"title":"무한 스크롤 구현하기"}},"previous":{"id":"cc46ebdf-d56e-53d2-ae84-c356d1276cba","fields":{"slug":"/lorem-ipsum-generator/"},"frontmatter":{"title":"한국의 시를 이용한 로렘 입숨 생성기"}}},{"node":{"id":"b6815257-873c-526f-822d-a29bdca965df","fields":{"slug":"/infinite-scroll/"},"frontmatter":{"title":"무한 스크롤 구현하기","date":"2023-09-02"}},"next":{"id":"d845d508-a997-505a-8949-49e09d24ceb3","fields":{"slug":"/useref/"},"frontmatter":{"title":"useRef 알아보기"}},"previous":{"id":"921c146d-b278-5852-9c6f-e1fbb57cb57d","fields":{"slug":"/wanted-preonboarding-review/"},"frontmatter":{"title":"원티드 프리온보딩 인턴십(프론트엔드) 후기"}}},{"node":{"id":"d845d508-a997-505a-8949-49e09d24ceb3","fields":{"slug":"/useref/"},"frontmatter":{"title":"useRef 알아보기","date":"2023-04-10"}},"next":{"id":"f1fb201d-65be-563b-b4cb-4820a32fef79","fields":{"slug":"/js-debouncing-n-throttling/"},"frontmatter":{"title":"자바스크립에서 이벤트 제어하기"}},"previous":{"id":"b6815257-873c-526f-822d-a29bdca965df","fields":{"slug":"/infinite-scroll/"},"frontmatter":{"title":"무한 스크롤 구현하기"}}},{"node":{"id":"f1fb201d-65be-563b-b4cb-4820a32fef79","fields":{"slug":"/js-debouncing-n-throttling/"},"frontmatter":{"title":"자바스크립에서 이벤트 제어하기","date":"2023-03-07"}},"next":{"id":"81144eb3-1a09-5e36-92b1-f5b0d561c44a","fields":{"slug":"/blog-publish-review/"},"frontmatter":{"title":"Gatsby로 블로그 만들기"}},"previous":{"id":"d845d508-a997-505a-8949-49e09d24ceb3","fields":{"slug":"/useref/"},"frontmatter":{"title":"useRef 알아보기"}}},{"node":{"id":"81144eb3-1a09-5e36-92b1-f5b0d561c44a","fields":{"slug":"/blog-publish-review/"},"frontmatter":{"title":"Gatsby로 블로그 만들기","date":"2023-03-01"}},"next":{"id":"6b7e5a80-3eed-5d27-880c-7a37b4bcbc79","fields":{"slug":"/teo-sprint-11th/"},"frontmatter":{"title":"테오의 스프린트 11기 후기"}},"previous":{"id":"f1fb201d-65be-563b-b4cb-4820a32fef79","fields":{"slug":"/js-debouncing-n-throttling/"},"frontmatter":{"title":"자바스크립에서 이벤트 제어하기"}}},{"node":{"id":"6b7e5a80-3eed-5d27-880c-7a37b4bcbc79","fields":{"slug":"/teo-sprint-11th/"},"frontmatter":{"title":"테오의 스프린트 11기 후기","date":"2022-09-01"}},"next":{"id":"d960a264-36d4-562b-8e91-176a4b81f47c","fields":{"slug":"/nth-type-difference/"},"frontmatter":{"title":"nth-child와 nth-of-type의 차이"}},"previous":{"id":"81144eb3-1a09-5e36-92b1-f5b0d561c44a","fields":{"slug":"/blog-publish-review/"},"frontmatter":{"title":"Gatsby로 블로그 만들기"}}},{"node":{"id":"d960a264-36d4-562b-8e91-176a4b81f47c","fields":{"slug":"/nth-type-difference/"},"frontmatter":{"title":"nth-child와 nth-of-type의 차이","date":"2022-08-16"}},"next":{"id":"8a0e2748-badb-5e01-b707-eebd5900a2ee","fields":{"slug":"/pleasy-intern-review/"},"frontmatter":{"title":"플리지 인턴 후기"}},"previous":{"id":"6b7e5a80-3eed-5d27-880c-7a37b4bcbc79","fields":{"slug":"/teo-sprint-11th/"},"frontmatter":{"title":"테오의 스프린트 11기 후기"}}},{"node":{"id":"8a0e2748-badb-5e01-b707-eebd5900a2ee","fields":{"slug":"/pleasy-intern-review/"},"frontmatter":{"title":"플리지 인턴 후기","date":"2022-07-16"}},"next":{"id":"78ae2e56-7d25-555f-885e-d55e458cb6a8","fields":{"slug":"/2nd-project-review/"},"frontmatter":{"title":"위코드 2차 프로젝트 후기"}},"previous":{"id":"d960a264-36d4-562b-8e91-176a4b81f47c","fields":{"slug":"/nth-type-difference/"},"frontmatter":{"title":"nth-child와 nth-of-type의 차이"}}},{"node":{"id":"78ae2e56-7d25-555f-885e-d55e458cb6a8","fields":{"slug":"/2nd-project-review/"},"frontmatter":{"title":"위코드 2차 프로젝트 후기","date":"2022-06-22"}},"next":{"id":"a91abd96-7814-5c35-a5da-90d266e4e40f","fields":{"slug":"/1st-project-review/"},"frontmatter":{"title":"위코드 1차 프로젝트 후기"}},"previous":{"id":"8a0e2748-badb-5e01-b707-eebd5900a2ee","fields":{"slug":"/pleasy-intern-review/"},"frontmatter":{"title":"플리지 인턴 후기"}}},{"node":{"id":"a91abd96-7814-5c35-a5da-90d266e4e40f","fields":{"slug":"/1st-project-review/"},"frontmatter":{"title":"위코드 1차 프로젝트 후기","date":"2022-06-06"}},"next":null,"previous":{"id":"78ae2e56-7d25-555f-885e-d55e458cb6a8","fields":{"slug":"/2nd-project-review/"},"frontmatter":{"title":"위코드 2차 프로젝트 후기"}}}]}},"staticQueryHashes":[],"slicesMap":{}}